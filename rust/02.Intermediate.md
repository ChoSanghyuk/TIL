# Rust Intermediate Concept



## Idiomatic Rust



### rustfmt

- rust에 맞는 포맷으로 code를 리팩토링 해줌

- 설치
  - `rustup component add rustfmt`
- 사용
  - `cargo fmt`
- Customize
  - root 폴더에 `.rustfmt.toml` 파일을 둠으로써, 커스터마이징 가능



### clippy

- 사용

  - `cargo clippy`

- 용도

  - 실제로 코드를 컴파일 => 450여 가지의 문제들에 대해서 체크해줌

- 대표 영역

  1. Style

     - rust convention에 맞는 방식으로 유도

  2. Correctness

     - outright wrong or very useless 한 코드에 대한 warning

  3. Complexity

     - 복잡한 코드를 간결하게 변경할 수 있도록 권고

     - certain / guess 하는 경우로 나누어짐

       :bulb: clippy의 경고를 무시하기 위해서는 `#[allow(clippy::경고이름)]` attribute를 소스에 추가

  4. Performance

:bulb: `clippy lints`를 검색해서 문서를 본다면, rust를 더 잘 작성하기 위한 tip들을 얻을 수 있음



###  :bulb:attribute

- 구조
  - `#[attribute]`
- 종류
  - `outer attribute`
    - it applies to the next item that it is outside of
    - 해당 attribute 바로 다음 소스에 대해서만 적용



## Documentation



### documentation

- 실행
  - `cargo doc`
  - `cargo doc --no-deps --open`
    - `--no-deps` : generate your library's documentation without generating all the documentation for all your dependencies
    - `--open` : automatically opens the index page of the generated documentation in your default browser
      - or `target/doc/packagename/index.html` 을 직접 열어야 함
- 대상
  - default로는 public 요소만 생성
  - private 요소도 생성하기 위해서는 별도 명령어 필요
- Tip
  - 항상 description을 최상단에 작성한 이후에 header들과 section 작성
  - 주로 implementation block에는 작성하지 X (주로 변수 작성 시에 대부분 내용이 들어감)



### Outer Documentation Comments

- 작성

  1. 라인

  ```rust
  /// Number of pieces in the puzzle
  ///
  /// #History
  ///
  /// - 블라블라
  pub const PUZZLE_PIECES:u32 = 42;
  ```

  2. 블록 

  ```rust
  /**
  Number of pieces in the puzzle
  
  #History
  ~~
  
  - Clickable link : [`PUZZLE_PIECES`]
  - 블라블라
  **/
  pub const PUZZLE_PIECES:u32 = 42;
  ```

- markdown 어법 사용

  - 예외

    - intra-doc links 

      - hyperlink to other parts of the documentation

      - [`PUZZLE_PIECES`] (`은 optional)

      - `[다른 문구](PUZZLE_PIECES)` 로도 가능

        :bulb: 만약 link 대상이 scope 안에 있지 않다면, absolute path로 지정 O

- 



### Inner Documentation Comments

- 용도
  - document main library, module that you're inside of
  - 변수, 메소드 바로 위에 작성하는 것이 아닌, 파일 전체에 관련한 내용 작성
  
- 작성
  - 라인 : `//!`
  - 블록 : `/*!   !*/`



## Publishing



### publish crate

- 특징

  - permanent

    :bulb: private credential, SSH key, AWS access token과 같은 정보 유의

  - Package name should be `Unique`
  - publish 후 `docs.rs`에 documentation 자동 등재

- 방법

  1. crates.io 접속

  2. Login
  3. Account Settings => API Access & get Token
  4. run `cargo login` & enter Token (once for a machine)
  5. `Cargo.toml` 작성
  6. run `cargo publish`

- `Cargo.toml` 설정 내역

  - 필수
    - name
    - version
  - 권장
    - description
    - edition
    - homepage
    - repository
    - readme
    - keyworks
      - 5개까지 검색 키워드 입력 O
      - `["game", "engine", "graphics"]`
    - categories
      - 5개까지 카테고리 등록 O. 
      - 카테고리 등록시 ,  `All Valid Category Slugs` 페이지의 해당 카테고리에서 볼 수 있음
      - `["game-engines"]`
    - license
      - package의 license 등록
      - 1개 초과 시, " " 안에서 `OR`로 구분 가능
      - `"MIT OR Apache-2.0"`



## Iterator



### iterator

```rust
let v = vec![6,7,8,9];

for num in v {
    println!("{}", num);
}
```

- for loop는 iterator을 탐색함
- 여기서 `v`는 iterator가 아닌데, 이 경우 `v.into_iter()` 자동으로 수행

- `into_iter()`
  - returns an iterator which **takes ownership** of the collection



### iterator with closure

```rust
let v = vec![6,7,8];

v.into_iter().for_each(|num| println!("{}", num));
```

- 장점
  -  `for loop`보다 빠름
  - Iterator Adaptors 사용 O



### Iterator Adaptors

- 개념

  - functional programming paradigm에서 제공하는 tool로, argument를 가지고 action을 수행 후 결과 반환
  - 대부분의 iterator trait의 메소드는 iterator adapters

- 특징

  - lazy

    - consumed 되기 전까진 실행 X

      => 마지막은 Iterator Consumer로 consume

- 기본 예제

  ```rust
  let v = vec![6,7,8];
  
   v.into_iter()
      .map(|x: i32| x*3)
      .filter(|y: &i32| *y%2 == 0)
      .for_each(|z| println!("{}", z));
  ```

  - map

    - value의 ownership 받아서 처리

  - filter

    - recieves an immutable reference to the value

      :bulb: filter는 true/false를 반환하는데, true인 값들을 이후에도 사용하기 위함

- Iterator Consumer

  - for_each
  - sum()
    - 



### Iterator Consumer

- iterator을 받아서 결과 처리 / 반환

- 반환 시, 타입 명시 필요

  - Type을 받을 때 generic으로 정의되어 있어, output의 type을 결정하는데 문제가 있음

    ```rust
    let v = vec![6,7,8];
    
    let total: i32 = v
    	.into_iter()
    	.map(|x: i32| x*3)
    	.filter(|y: &i32| *y%2 == 0)
    	.sum();
    ```

    



























