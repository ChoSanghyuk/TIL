# 데이터 모델링

## 개요

### 학습 목표

- 데이터 모델링 개념
- 작업 절차
- 기본 구성 요소 / 기본 가이드

### 데이터 분석 절차

- 고객 비지니스 이해 ~> 논리 ERD 도출 → 시스템 성능 고려 ~> 물리 ERD 전환

산발적, 중복적 존재 데이터 ⇒ 논리 데이터 모델링 ⇒ 논리 ERD ⇒ 물리 데이터 모델링 ⇒ 물리 ERD

| 논리 ERD                                         | 물리 ERD                                                     |
| ------------------------------------------------ | ------------------------------------------------------------ |
| 일반 용어                                        | DBMS 용어                                                    |
| Entity , Attribute, Identifier, Occurrence       | Table, Column, PK, Row, Index                                |
| 업무중심<br />정규화 <br />중복 배제<br />유연성 | 성능중심 <br />반정규화 <br />중복 허용 <br />파티셔닝 / 집계 테이블 도출 |

## 논리 데이터 모델링

### 1. 개요

#### 데이터 분석

- 현행 시스템 사용 용어 / 도메인 조사 ⇒ 엔터티 도출, 속성 / 식별자 / 관계 정의
- 정보 구조를 체계적으로 분석
- 목적
  - 정보를 구조화하여 고객 업무 파악
  - 안정적 시스템의 기초

#### 논리 데이터 모델

- 정의
  - 기술적 구현과 독립적으로 업무 관점에서 표현한 모델
- 주요 특성
  - Communication 수단
    - 고객 + 분석 / 설계자 / 개발자와 효율적인 공유 및 검토
  - 데이터 고유 특성 표현
    - 정규화 ~> 무결성 / 일관성
  - 특정 DBMS 종속 X
- 주요 구성 요소와 산출물

| 주제영역 | 조직에서 관심을 가지는 기능 / 주요 토픽에 대한 엔터티 그룹 | 주제영역 정의서        |
| -------- | ---------------------------------------------------------- | ---------------------- |
| 엔터티   | 유용한 정보 저장 / 관리 단위                               | 엔터티 정의서          |
| 관계     | 엔터티 사이 논리적 연결. 비지니스 규칙                     | 논리 ERD               |
| 식별자   | 엔터티의 개체 (Occurence) 유일하게 구분                    | 용어사전 도메인 정의서 |
| 속성     | 더 이상 분리 X 최소의 데이터 단위                          | 속성 정의서            |


### 2. 주제영역 정의

#### 주제영역

- 목적
  - 업무 사이 인터페이스 필요 유무 확인
  - 업무 오너십 구분


### 3. 엔터티 정의

#### 엔터티 유형

| 유형        | 설명                                                         | 예시                     |
| ----------- | ------------------------------------------------------------ | ------------------------ |
| 중심 엔터티 | 주제 영역 내에서 가장 핵심 엔티티<br />주제 영역과 동일 이름 | 고객, 주문, 제품         |
| 독립 엔터티 | 다른 엔터티와 관계없이 생성 가능                             | 고객, 제품               |
| 의존 엔터티 | 의존적인 엔터티                                              | 고객주소, 주문, 주문항목 |
| 특성 엔터티 | 특정 엔터티의 특징 설명<br />항상 의존 엔터티                | 고객주소                 |
| 연관 엔터티 | 두개 이상의 엔터티에 의존<br />다대다 관계 연결              | 주문항목                 |

- 슈퍼 / 서브 타입 엔터티
  - 엔터티의 특정 Occurrence 들이 고유한 속성과 관계 가짐
  - 많이 도출될 수록 비지니스 파악 용이
  - 배타적 관계와 포함관계로 구분 (표기법 상이)

#### 엔터티 도출 절차

1. 엔터티 선정
   - 현행 테이블 정의서 제공받아 대상 엔터티 선정
2. 엔터티 정의서 작성
3. 검토 및 검증
4. ERD에 엔터티 표현


### 4. 관계 정의

#### 관계란

- 동사 표현
- 상호적 의미
- 둘 또는 스스로 관계 o
- 하나의 관계는 두가지 관점

#### 관계의 3요소

- Membership
  - 관계에 참여한 각각의 엔터티 관점에서 관계 표현
- Cardinality
  - 다중성 표시
- Optionality
  - 필수 / 선택 표시

#### M:M 관계 해소

- 관계 엔터티 생성
- 식별자에 의한 통합
- 속성에 의한 통합

#### (참고) M:M 문제 이유

#### 1:M 자기 참조 관계

- 한 엔터티 내 Occurrence와 Occurrence가 1:M 관계
- 레벨 속성을 두어 특정 레벨 접근 용이 O

#### 1:1 자기 참조 관계

- 한 엔터티 내 Occurrence와 Occurrence가 1:1 관계

#### 아크(Arc) 관계

- 둘 이상의 상위 엔터티로부터 동일한 역할의 외부 식별자 선택적으로 받아옴
- 외부 식별자를 생성 / 통합하여 새로운 외부식별자 생성 가능
  - 하나의 속성으로 관리 O (Not Null 가능)
  - 식별자구분코드로 상위 엔터티 구분 O

### 5. 식별자 정의

#### 식별자

- 엔터티 내 Occurrence 구분할 수 있는 구분자
- 분류
  - 주식별자
  - 보조식별자
  - 내부식별자
  - 외부식별자
- 규칙
  - 유일성
  - 최소성
  - Not Null
  - Never Change

#### 식별자 관계

- 식별자 관계
  - 부모 엔터티 타입의 주식별자 상속 ⇒ 자식의 주식별자로 사용
  - 부모 없는 자식 생성 X
- 비식별자 관계
  - 일반 속성으로 사용
  - 독립적 생성


### 6. 속성

#### 속성

- 더 이상 분리 x 최소의 데이터 단위
- 구분
  - 기본
  - 설계(Designed) : 필요 정보 주기 위해, 시스템적 고안. (ex. 코드)
  - 파생(Derived)
    - 타 속성 ~> 속성
    - 명확 기재 시, 비지니스 규칙 파악 용이 / 검증 규칙 활용 O
- 고객의 용어 사전 / 현행 테이블 정의서 활용

### 7. 정규화

#### 정규화

- 기본 원칙은 테이블에 중복 데이터 방지
- 중요성
  - 입력 / 수정 / 삭제의 이상현상 제거
- 함수의 종속성
  - 데이터들이 어떤 기준 값에 의해 종속되는 현상 ( 결정자 ~> 종속자 )
- 정규화 단계
- 1~3, 보이스코드 : 함수종속성에 따른 이상현상 제거
- 4,5 : 업무적 제약조건에 따른 이상현상 제거

#### 1차 정규화

- 반복적인 속성값이 나타내는 경우(같은 성격과 내용의 속성이 중복) 별도 분리 
- 하나의 컬럼에는 여러 개의 데이터 값이 반복되지 않아야 함
- PK에 대한 원자속성 확보

#### 2차 정규화

- 주식별자 전체에 종속적이지 않은 속성 분리
- 주식별자 중 일부에 종속적인 속성 분리

#### 3차 정규화

- 일반 속성에 종속적인 속성 분리

#### 보이스코드 정규화

- 식별자 내에 속성 사이 종속성이 있는 경우 분리

#### 4차 정규화

- 여러 값을 중복으로 삽입해야 하는 종속성 제거
- 두 개 이상의 독립적인 다가 속성 존재 시, 다가 종속이 발생되면 대상

#### 5차 정규화

- 여러 값을 중복으로 삽입해야 하는 종속성 제거
- 하나의 테이블에 조인 종속 존재 시 대상



#### [참고] ERD 관계선과 기호

- 관계선
  - 실선(Identifying): 식별관계
    - 부모테이블의 PK가 자식테이블의 FK/PK가 되는 경우
    - 부모가 있어야 자식이 생기는 경우
  - 점선(Non-Identifying): 비식별관계
    - 부모테이블의 PK가 자식테이블의 일반속성이 되는 경우
    - 부모가 없어도 자식이 생기는 경우
- 기호

  - `|` : 1개 
    - `||` : 정확히 1

  - `∈` : 여러 개
  - `O` : 0개

  




### 8. 상관 모델링 및 모델 통합 / 검토

#### 상관 모델링

- 데이터에 관한 프로세스 / 프로세스에 의한 데이터 영향 분석
- 데이터 모델링 작업 ⇒ 엔터티 타입 + 프로세스 모델링 ⇒ 단위 프로세스 활용
- 목적
  - 정합성 검증 ⇒ 중복 / 누락 엔터티, 프로세스 도출
- 산출물
  - CRUD 매트릭스
  - DFD(Data Flow Diagram)
  - 화면 정의서

#### 논리 모델 통합 / 검토

- 논리데이터 모델 통합
  - 주제영역별로 작성된 논리 모델을 통합
  - 누락, 중복, 유사 엔터티 및 누락 주제영역 도출
  - 모델에 대한 오너십
- 데이터 모델링 체크리스트 ⇒ 검토

## 3. 물리 데이터 모델링

### 3.1 개요

- 물리 데이터 모델 개념
- 관계형 테이블 전환 / 통합과 분리 / 반정규화 / 물리변환 이해

#### 물리 데이터 모델링

- 목적
  - 논리 데이터 모델링은 성능 보장 x.
  - 무결성이 저하되더라도 성능 향상 고려한 물리 모델링
- 절차
  - 관계형 테이블 전환
    - 엔터티 ⇒ 테이블 / 속성 ⇒ 컬럼
    - 주 식별자 ⇒ PK / 외부 식별자 ⇒ FK
  - 통합 / 분리 결정
    - 슈퍼타입 - 서브타입 모델 물리 전환
      - 통합 테이블 전환
      - 개별 테이블 전환
      - 각 서브 타입 테이블 전환
    - 대용량/성능 이슈 테이블 통합/분리
  - 이력 / 코드 / 채번 테이블 도출
  - 반정규화
    - 컬럼 / 테이블 / 관계
  - 물리명 전환
    - 물리 ERD ⇒ Table 설계

### 3.2 테이블 전환

#### 관계형 테이블 전환

| 논리 데이터 모델 | 물리 데이터 모델 |
| ---------------- | ---------------- |
| Entity           | Table            |
| Attribute        | Column           |
| Occurence        | Row              |
| Identifier       | PK               |
| RelationShip     | FK               |

#### PK 전환

- 대체키 사용
  - 저장 공간 줄여 속도 up
  - 중요 자료 보안 처리
  - 변경에 영향 작음
  - 기존 PK 정보 얻기 위해선  JOIN 필요
- PK로 데이터 유일 식별
  - Unique Index 설정만이 아닌 반드시 PK 설정 필요
    - Unique Index는 Null 허용
  - PK 없으면 FK 생성 X , 참조 무결성 제약 조건 X
- PK UPD = DEL + INS

### 3.3 반정규화

#### 반정규화

- 주의 사항
  - 반정규화만이 조희 성능 향상 X
- 절차
  - 대상조사 ⇒ 다른 방법 유도 검토 ⇒ 반정규화 적용

#### 반정규화 방법

- 테이블
  - 집계 테이블
    - 온라인으로 집계성 조회 ⇒ 시스템 부담
    - 미리 계산하여 별도 테이블 생성
    - 생성 방법
      - 온라인
      - 지연(Deferred)
      - 일괄(Batch)
  - 수직 / 수평 분할
    - 수직 분할
      - 활용 빈도 관점에서 Entity  속성 분할
    - 수평 분할
      - Occrrence 분할
- 컬럼
  - 중복컬럼 추가
  - 파생컬럼 추가
  - 이력테이블 컬럼 추가
  - PK에 의한 컬럼 추가
  - 응용시스템 오작동 위한 컬럼
    - 이전 데이터 임시적 중복 보관
- 관계
  - 중복관계추가

### 3.4 이력/채번/코드 테이블

#### 이력관리

- 과거와 현재 데이터 지속적 관리 방법
- 유형
  - 변경이력
    - 최종 조회 다
  - 발생이력
    - 시점 별
  - 진행이력
    - 중간 시점

#### 3.5 물리명 적용

#### 물리명 적용

- 논리 데이터 모델의 엔터티명과 속성명을 영문 컬럼 / 테이블로 변경

#### 관계형 데이터베이스의 무결성

- 엔터티 무결성
  - 모든 데이터 유일
- 참조 무결성
  - 홀로 존재 X, 의존
- 도메인 무결성
  - 컬럼 값 일정 제한

### 3.6 성능 관점의 물리 모델링

#### 반정규화 성능 저하 사례

- 중복 속성 제거
  - UPD시, 모든 테이블 찾아서 UPD 필요
  - 변경 빈도수 높거나, 보안 필요 ⇒ 반정규화 지양

## 4.데이터 표준화 / 품질 / 전환

### 4.1 데이터 표준화

#### 데이터 표준

- 공통 형식 정의 ⇒ 커뮤니케이션 / 일관성,정합성 / 데이터 품질
- 구성 항목
  - 단어 : 일정 의미 가지는 최소 단위
  - 표준용어
    - 단어 조합 + 도메인(끝) ⇒ 속성명 사용
    - 업무 용도 / 데이터 물리 특성 고려하여 정의
  - 도메인 : 그룹화하여 데이터 유형과 길이 정의
  - 도메인그룹
  - 데이터 타입
- 사례
  - 동음이의어
  - 복합단어 (길이문제)
  - 코드, 번호 도메인 구체화
    - 용어의 특성에 맞게 구체화
    - 가변길이 도메인 사용 지양
  - 용어명 상세화

#### 코드 표준화

- 코드 도메인 오너십 결정
- 오너십 별 코드 유효값의 통합 가능 여부 검증 ⇒ 통합 / 관리
- 목적
  - 효율 / 일관

### 4.2 데이터 품질

#### 데이터 품질 관리 프로세스

1. 계획
2. 정의
3. 측정
4. 분석
   - 품질개선 방안 도출까지
5. 개선

#### 정의 단계

- 완정성

  - 개별완전성
  - 조건완정성

- 유효성

  - 범위유효성
  - 날짜유효성
  - 형식유효성

- 정확성

  - 선후관계정확성
  - 계산 / 집계 정확성
  - 최신성
  - 업무규칙정확성

- 유일성

  - 단독유일성
  - 조건유일성

- 일관성

  - 기준코드일관성
  - 참조무결성
  - 데이터흐름일관성
  - 컬럼일관성


### 4.3 데이터 전환

#### 데이터 전환

  - AS-IS 데이터 ⇒ TO-BE 데이터
  - 데이터 전환 설계
    - 전환 후 데이터 검증 할 수 있는 요건 정리
    - 계수 검증 : 건수 / 합계
  - 절차
    - 계획 및 요건 ⇒ 설계 ⇒ 개발 ⇒ 검증 ⇒ 수행
  - 데이터 전환 조직과 역할
    - 응용팀
      - 전환 대상 확정
      - 매핑 정의서 작성
      - 검증 항목 / 방법 정의
  - 주의점
    - 반드시 분석 / 설계자가 수행